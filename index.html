<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bitácora Mental</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root { --primary: #4F6F52; --secondary: #A7C4B5; --bg: #F9FBFA; --text: #1F2933; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; }
    h1, h2, h3 { font-family: 'Outfit', sans-serif; }
    
    /* Navbar y Banner */
    .promo-banner { background: var(--secondary); color: var(--text); text-align: center; padding: 10px; font-weight: 700; display: none; }
    .navbar { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.9); position: sticky; top: 0; z-index: 100; }
    .logo { font-size: 1.4rem; font-weight: 700; color: var(--primary); text-decoration: none; }
    .btn-nav { padding: 10px 20px; border: 2px solid var(--primary); border-radius: 20px; text-decoration: none; color: var(--primary); font-weight: 600; }
    
    /* Estilos Generales de Secciones */
    section { padding: 80px 8%; }
    .btn-primary { background: var(--primary); color: white; padding: 15px 30px; border-radius: 12px; text-decoration: none; display: inline-block; font-weight: 600; }
    
    /* Estilos Específicos (simplificados para el ejemplo) */
    .hero { text-align: center; background: radial-gradient(circle, rgba(167,196,181,0.2), transparent); }
    .hero h1 { font-size: 3rem; margin-bottom: 20px; }
    
    .steps-grid, .pricing-grid, .testi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; margin-top: 40px; }
    .card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); text-align: center; }
    
    .cta-final { background: var(--primary); color: white; text-align: center; }
    .cta-final .btn-primary { background: white; color: var(--primary); }
  </style>
</head>
<body>

  <div id="topBanner" class="promo-banner"></div>

  <nav class="navbar">
    <a href="#" class="logo"><i class="fas fa-brain"></i> Bitácora</a>
    <a href="login.html" class="btn-nav">Entrar</a>
  </nav>

  <main id="dynamicContent"></main>

  <template id="tpl-hero">
    <section class="hero">
      <h1 data-key="hero_titulo">...</h1>
      <p data-key="hero_subtitulo" style="font-size:1.2rem; margin-bottom:30px; max-width:600px; margin-inline:auto;">...</p>
      <a href="registro.html" class="btn-primary" data-key="hero_btn">...</a>
    </section>
  </template>

  <template id="tpl-como-funciona">
    <section>
      <div style="text-align:center;">
        <h2 data-key="steps_titulo">...</h2>
        <p data-key="steps_subtitulo">...</p>
      </div>
      <div class="steps-grid">
        <div class="card"><h3>1. Entrevista</h3><p>Cuéntanos tu historia.</p></div>
        <div class="card"><h3>2. Conexión</h3><p>Encuentra tu psicólogo.</p></div>
        <div class="card"><h3>3. Progreso</h3><p>Mejora día a día.</p></div>
      </div>
    </section>
  </template>

  <template id="tpl-precios">
    <section style="background:var(--bg);">
      <h2 style="text-align:center;" data-key="pricing_titulo">...</h2>
      <div class="pricing-grid">
        <div class="card"><h3>Básico</h3><h2 style="color:var(--primary);">S/ <span data-key="pricing_card_1_precio">0</span></h2></div>
        <div class="card" style="border:2px solid var(--primary)"><h3>Kit</h3><h2 style="color:var(--primary);">S/ <span data-key="pricing_card_2_precio">19</span></h2></div>
        <div class="card"><h3>Terapia</h3><h2 style="color:var(--primary);">S/ <span data-key="pricing_card_3_precio">165</span></h2></div>
      </div>
    </section>
  </template>

  <template id="tpl-testimonios">
    <section>
      <h2 style="text-align:center;" data-key="testi_titulo">...</h2>
      <div class="testi-grid">
        <div class="card"><p>"Me cambió la vida por completo."</p><strong>- Ana R.</strong></div>
        <div class="card"><p>"La plataforma es súper fácil de usar."</p><strong>- Carlos M.</strong></div>
        <div class="card"><p>"Encontré al terapeuta ideal."</p><strong>- Sofia L.</strong></div>
      </div>
    </section>
  </template>

  <template id="tpl-cta-final">
    <section class="cta-final">
      <h2 data-key="cta_final_titulo">...</h2>
      <br>
      <a href="registro.html" class="btn-primary" data-key="cta_final_btn">...</a>
    </section>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase-config.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
        if (!window.sb) return;

        // 1. Cargar Configuración
        const { data: configs } = await window.sb.from('config_interfaz').select('*');
        if(!configs) return;

        // 2. Aplicar Estilos Globales
        const setVar = (key, cssVar) => {
            const item = configs.find(c => c.clave === key);
            if(item) document.documentElement.style.setProperty(cssVar, item.valor);
        };
        setVar('style_color_primary', '--primary');
        setVar('style_color_secondary', '--secondary');
        setVar('style_bg_color', '--bg');

        // 3. Aplicar Banner Promocional
        const promoActive = configs.find(c => c.clave === 'promo_top_active')?.valor === 'true';
        if(promoActive) {
            const banner = document.getElementById('topBanner');
            banner.style.display = 'block';
            banner.textContent = configs.find(c => c.clave === 'promo_top_text')?.valor || 'Oferta';
            banner.style.backgroundColor = configs.find(c => c.clave === 'promo_top_color')?.valor;
        }

        // 4. CONSTRUIR LAYOUT (El corazón del sistema)
        const layoutConfig = configs.find(c => c.clave === 'home_layout_config');
        const sectionOrder = layoutConfig ? JSON.parse(layoutConfig.valor) : ['hero', 'precios']; // Fallback
        
        const main = document.getElementById('dynamicContent');

        sectionOrder.forEach(sectionId => {
            const template = document.getElementById(`tpl-${sectionId}`);
            if(template) {
                const clone = template.content.cloneNode(true);
                
                // Rellenar textos dentro de esta sección clonada
                clone.querySelectorAll('[data-key]').forEach(el => {
                    const key = el.getAttribute('data-key');
                    const configItem = configs.find(c => c.clave === key);
                    if(configItem) el.textContent = configItem.valor.replace(/\\n/g, '\n');
                });

                main.appendChild(clone);
            }
        });
    });
  </script>
</body>
</html>
