<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test de Bienestar - Bitácora Mental</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary: #4F6F52;
      --primary-light: #6B8A6E;
      --secondary: #A7C4B5;
      --background: #F9FBFA;
      --dark: #1F2933;
      --text-secondary: #6B7280;
      --border: #E6EFE8;
      --danger: #EF4444;
      --warning: #F59E0B;
      --success: #10B981;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: var(--background); color: var(--dark); line-height: 1.6; }
    h1, h2, h3 { font-family: 'Outfit', sans-serif; }

    .test-container { max-width: 900px; margin: 0 auto; padding: 40px 20px; min-height: 100vh; }
    .test-header { text-align: center; margin-bottom: 40px; }
    .logo { display: inline-flex; align-items: center; gap: 12px; font-weight: 700; font-size: 1.4rem; color: var(--primary); text-decoration: none; }

    /* Cards */
    .card { background: white; border-radius: 24px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.08); margin-bottom: 30px; border: 1px solid var(--border); }
    .welcome-screen { text-align: center; }
    .welcome-icon { font-size: 4rem; color: var(--primary); margin-bottom: 20px; }

    /* Progress Bar */
    .progress-container { margin-bottom: 32px; background: white; padding: 20px; border-radius: 16px; border: 1px solid var(--border); }
    .progress-bar { width: 100%; height: 10px; background: var(--border); border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; background: var(--primary); transition: width 0.4s ease; width: 0%; }

    /* Questions */
    .question-card { display: none; animation: fadeInUp 0.5s ease; }
    .question-card.active { display: block; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

    .scale-options { display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px; margin: 30px 0; }
    .scale-option { aspect-ratio: 1; border: 2px solid var(--border); border-radius: 15px; cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; }
    .scale-option.selected { background: var(--primary); border-color: var(--primary); color: white; transform: scale(1.05); }

    /* Results */
    .results-screen { display: none; }
    .results-screen.active { display: block; }
    .score-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 30px 0; }
    .score-item { background: var(--background); padding: 20px; border-radius: 15px; text-align: center; }
    .score-value { font-size: 2rem; font-weight: 700; color: var(--primary); }

    /* Conversion Elements */
    .countdown-timer { background: #FFF4F4; color: #D32F2F; padding: 10px 20px; border-radius: 50px; font-weight: 700; display: inline-block; margin-bottom: 20px; border: 1px solid #FFCDD2; }
    .guarantee-badge { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.85rem; color: var(--text-secondary); margin-top: 15px; }

    /* Planes */
    .plans-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
    .plan-card { background: white; border: 2px solid var(--border); border-radius: 20px; padding: 30px; position: relative; transition: 0.3s; }
    .plan-card.recommended { border-color: var(--primary); transform: scale(1.03); box-shadow: 0 15px 30px rgba(79, 111, 82, 0.15); }
    .plan-badge { position: absolute; top: -12px; right: 20px; background: var(--primary); color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; }

    .btn { width: 100%; padding: 16px; border-radius: 12px; font-weight: 700; cursor: pointer; border: none; transition: 0.3s; font-family: 'DM Sans', sans-serif; font-size: 1rem; }
    .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 15px rgba(79, 111, 82, 0.3); }
    .btn-primary:hover { transform: translateY(-3px); background: var(--primary-light); }
    .btn-plan { background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white; margin-top: 20px; }

    @media (max-width: 768px) { .score-grid, .plans-grid { grid-template-columns: 1fr; } .scale-label { display: none; } }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <a href="index.html" class="logo"><i class="fas fa-brain"></i> Bitácora Mental</a>
    </div>

    <div class="progress-container" id="progressContainer" style="display: none;">
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <p style="text-align: center; margin-top: 10px; font-size: 0.9rem; color: var(--text-secondary);">Pregunta <span id="currentQNum">1</span> de 10</p>
    </div>

    <div class="card welcome-screen" id="welcomeScreen">
      <div class="welcome-icon"><i class="fas fa-clipboard-check"></i></div>
      <h1>Evaluación de Bienestar</h1>
      <p>Entiende tu estado emocional hoy. Solo toma 5 minutos y es totalmente privado.</p>
      <div class="info-box">
        <div class="info-item"><i class="fas fa-shield-alt"></i><span>Resultados 100% privados</span></div>
        <div class="info-item"><i class="fas fa-magic"></i><span>Recomendación personalizada de plan</span></div>
      </div>
      <button class="btn btn-primary" onclick="startTest()">Comenzar Evaluación Gratis</button>
    </div>

    <div id="questionsContainer"></div>

    <div class="results-screen" id="resultsScreen">
      <div class="card" style="text-align: center;">
        <div class="countdown-timer"><i class="fas fa-clock"></i> Oferta de bienvenida expira en: <span id="timer">15:00</span></div>
        <h2>Tu perfil de bienestar</h2>
        <div class="score-grid" id="scoresGrid"></div>
        <p id="recommendationText" style="color: var(--text-secondary);"></p>
      </div>

      <h3 style="text-align: center; margin: 40px 0 20px;">Planes sugeridos para tu nivel de necesidad</h3>
      <div class="plans-grid" id="plansGrid"></div>
    </div>
  </div>

  <script>
    const questions = [
      { id: 1, cat: 'ansiedad', text: '¿Con qué frecuencia te sientes nervioso/a o ansioso/a?' },
      { id: 2, cat: 'ansiedad', text: '¿Te cuesta relajarte o tranquilizarte?' },
      { id: 3, cat: 'estres', text: '¿Te sientes abrumado/a por tus responsabilidades?' },
      { id: 4, cat: 'estres', text: '¿Tienes dificultad para concentrarte?' },
      { id: 5, cat: 'animo', text: '¿Cómo describirías tu estado de ánimo general?' },
      { id: 6, cat: 'animo', text: '¿Disfrutas de las actividades habituales?' },
      { id: 7, cat: 'sueno', text: '¿Cómo calificarías la calidad de tu sueño?' },
      { id: 8, cat: 'social', text: '¿Te sientes conectado/a con otros?' },
      { id: 9, cat: 'motivacion', text: '¿Sientes motivación para tus metas?' },
      { id: 10, cat: 'general', text: '¿Cómo calificarías tu bienestar emocional actual?' }
    ];

    let currentIdx = 0;
    let answers = {};

    function startTest() {
      document.getElementById('welcomeScreen').style.display = 'none';
      document.getElementById('progressContainer').style.display = 'block';
      renderQ(0);
    }

    function renderQ(idx) {
      const q = questions[idx];
      const container = document.getElementById('questionsContainer');
      container.innerHTML = `
        <div class="card question-card active">
          <h2 class="question-text">${q.text}</h2>
          <div class="scale-options">
            ${[1,2,3,4,5].map(v => `
              <div class="scale-option ${answers[q.id] == v ? 'selected' : ''}" onclick="select(${q.id}, ${v})">
                <span class="scale-number">${v}</span>
              </div>`).join('')}
          </div>
          <div style="display: flex; gap: 15px;">
            ${idx > 0 ? `<button class="btn btn-secondary" onclick="renderQ(${idx-1})">Anterior</button>` : ''}
            <button class="btn btn-primary" onclick="next(${idx})" ${answers[q.id] ? '' : 'disabled'}>${idx === 9 ? 'Ver Resultados' : 'Siguiente'}</button>
          </div>
        </div>`;
      document.getElementById('currentQNum').innerText = idx + 1;
      document.getElementById('progressFill').style.width = ((idx + 1) / 10) * 100 + '%';
    }

    function select(id, v) { answers[id] = v; renderQ(questions.findIndex(q => q.id === id)); }
    
    function next(idx) { 
      if(idx < 9) renderQ(idx + 1); 
      else showResults();
    }

    function showResults() {
      const scores = {
        ansiedad: Math.round(((answers[1] + answers[2]) / 10) * 10),
        estres: Math.round(((answers[3] + answers[4]) / 10) * 10),
        animo: Math.round(((12 - (answers[5] + answers[6])) / 10) * 10)
      };

      document.getElementById('questionsContainer').style.display = 'none';
      document.getElementById('progressContainer').style.display = 'none';
      document.getElementById('resultsScreen').classList.add('active');

      const getLvl = (s) => s <= 3 ? 'low' : s <= 6 ? 'medium' : 'high';
      document.getElementById('scoresGrid').innerHTML = `
        <div class="score-item"><span>Ansiedad</span><div class="score-value ${getLvl(scores.ansiedad)}">${scores.ansiedad}/10</div></div>
        <div class="score-item"><span>Estrés</span><div class="score-value ${getLvl(scores.estres)}">${scores.estres}/10</div></div>
        <div class="score-item"><span>Ánimo</span><div class="score-value ${getLvl(scores.animo)}">${scores.animo}/10</div></div>
      `;

      renderFinalPlans(scores);
      startTimer();
    }

    function renderFinalPlans(scores) {
      const avg = (scores.ansiedad + scores.estres) / 2;
      const plans = [
        { id: 'kit', name: 'Kit Emocional', price: 'S/ 19', feat: ['Audios relajación', '5 Workbooks'], show: avg < 7 },
        { id: 'acom', name: 'Acompañamiento', price: 'S/ 165', feat: ['2 sesiones/mes', 'Soporte WhatsApp'], show: true, recommended: true },
        { id: 'prem', name: 'Premium', price: 'S/ 300', feat: ['4 sesiones/mes', 'Psicólogos senior'], show: avg >= 6 }
      ];

      document.getElementById('plansGrid').innerHTML = plans.filter(p => p.show).map(p => `
        <div class="plan-card ${p.recommended ? 'recommended' : ''}">
          ${p.recommended ? '<div class="plan-badge">IDEAL PARA TI</div>' : ''}
          <h3>${p.name}</h3>
          <div class="plan-price">${p.price}</div>
          <ul style="list-style: none; margin: 15px 0; font-size: 0.85rem;">
            ${p.feat.map(f => `<li><i class="fas fa-check" style="color: var(--primary)"></i> ${f}</li>`).join('')}
          </ul>
          <button class="btn btn-plan" onclick="window.location.href='registro.html?plan=${p.id}'">Elegir ${p.name}</button>
          <div class="guarantee-badge"><i class="fas fa-shield-check"></i> Garantía 7 días</div>
        </div>`).join('');
    }

    function startTimer() {
      let t = 900;
      setInterval(() => {
        let m = Math.floor(t/60), s = t%60;
        document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
        if(t > 0) t--;
      }, 1000);
    }
  </script>
</body>
</html>
