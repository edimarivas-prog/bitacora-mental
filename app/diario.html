<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Diario - Bit치cora Mental</title>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Estilos copiados y unificados con Dashboard */
    :root { --primary: #4F6F52; --primary-light: #6B8A6E; --bg: #F9FBFA; --dark: #1F2933; --text-sec: #6B7280; --border: #E6EFE8; --radius: 16px; --shadow: 0 4px 20px rgba(0,0,0,0.06); }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg); color: var(--dark); line-height: 1.6; }
    
    /* Layout Global */
    .dashboard-container { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
    
    /* Sidebar Robusto (Igual al Dashboard) */
    .sidebar { background: white; border-right: 1px solid var(--border); padding: 24px 0; position: sticky; top: 0; height: 100vh; display: flex; flex-direction: column; z-index: 100; }
    .sidebar-header { padding: 0 24px 24px; border-bottom: 1px solid var(--border); }
    .logo { display: flex; align-items: center; gap: 12px; font-family: 'Outfit', sans-serif; font-weight: 700; font-size: 1.3rem; color: var(--primary); text-decoration: none; }
    .sidebar-nav { flex: 1; padding: 24px 0; overflow-y: auto; }
    .nav-section { margin-bottom: 24px; }
    .nav-section-title { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-sec); padding: 0 24px 8px; }
    .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 24px; color: var(--dark); text-decoration: none; transition: all 0.2s; border-left: 3px solid transparent; }
    .nav-item:hover { background: var(--bg); color: var(--primary); }
    .nav-item.active { background: rgba(79, 111, 82, 0.08); color: var(--primary); border-left-color: var(--primary); font-weight: 600; }
    .sidebar-footer { padding: 0 24px; border-top: 1px solid var(--border); padding-top: 20px; margin-top: auto; }
    .user-profile { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg); border-radius: 12px; }
    .user-avatar { width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; }
    
    /* Contenido Diario */
    .main-content { padding: 32px 40px; }
    .page-header h1 { font-family: 'Outfit'; font-size: 2rem; color: var(--dark); margin-bottom: 5px; }
    .page-subtitle { color: var(--text-sec); margin-bottom: 30px; }

    .diary-grid { display: grid; grid-template-columns: 300px 1fr; gap: 24px; height: calc(100vh - 150px); }
    
    /* Calendario Lateral */
    .cal-card { background: white; border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); display: flex; flex-direction: column; }
    .cal-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: 700; color: var(--primary); }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; }
    .day { aspect-ratio: 1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 0.9rem; cursor: pointer; transition: 0.2s; }
    .day:hover { background: var(--bg); }
    .day.active { background: var(--primary); color: white; font-weight: 600; }
    .day.has-entry { position: relative; }
    .day.has-entry::after { content: ''; position: absolute; bottom: 4px; width: 4px; height: 4px; background: #F59E0B; border-radius: 50%; }

    /* Editor */
    .editor-card { background: white; border-radius: var(--radius); padding: 40px; box-shadow: var(--shadow); display: flex; flex-direction: column; position: relative; }
    .editor-toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }
    .date-title { font-family: 'Outfit'; font-size: 1.5rem; font-weight: 600; }
    .emotions-bar { display: flex; gap: 10px; }
    .emo-btn { border: 1px solid var(--border); background: white; padding: 8px 12px; border-radius: 20px; cursor: pointer; transition: 0.2s; font-size: 0.9rem; }
    .emo-btn:hover, .emo-btn.selected { border-color: var(--primary); background: #E8F5E9; color: var(--primary); }
    
    textarea { flex: 1; border: none; resize: none; font-size: 1.1rem; line-height: 1.8; color: var(--dark); font-family: 'DM Sans', sans-serif; outline: none; }
    textarea::placeholder { color: #CBD5E1; }
    .save-indicator { font-size: 0.85rem; color: var(--text-sec); display: flex; align-items: center; gap: 6px; }

    @media (max-width: 968px) {
        .dashboard-container { grid-template-columns: 1fr; }
        .sidebar { display: none; } /* Aqu칤 deber칤as agregar tu bot칩n men칰 m칩vil si lo deseas */
        .diary-grid { grid-template-columns: 1fr; height: auto; }
        .cal-card { display: none; } /* Ocultar calendario en m칩vil o moverlo */
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="dashboard.html" class="logo"><i class="fas fa-brain"></i> Bit치cora Mental</a>
      </div>
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Principal</div>
          <a href="dashboard.html" class="nav-item"><i class="fas fa-home"></i> <span>Dashboard</span></a>
          <a href="citas.html" class="nav-item"><i class="fas fa-calendar-alt"></i> <span>Mis Citas</span></a>
          <a href="especialistas.html" class="nav-item"><i class="fas fa-user-md"></i> <span>Especialistas</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Mi Espacio</div>
          <a href="diario.html" class="nav-item active"><i class="fas fa-book"></i> <span>Mi Diario</span></a>
          <a href="progreso.html" class="nav-item"><i class="fas fa-chart-line"></i> <span>Mi Progreso</span></a>
          <a href="recursos.html" class="nav-item"><i class="fas fa-folder-open"></i> <span>Recursos</span></a>
        </div>
        <div class="nav-section">
          <div class="nav-section-title">Cuenta</div>
          <a href="plan.html" class="nav-item"><i class="fas fa-crown"></i> <span>Mi Plan</span></a>
          <a href="perfil.html" class="nav-item"><i class="fas fa-user-circle"></i> <span>Perfil</span></a>
          <a href="#" onclick="logout()" class="nav-item"><i class="fas fa-sign-out-alt"></i> <span>Salir</span></a>
        </div>
      </nav>
      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="user-avatar" id="avatarInitials">--</div>
          <div style="font-size:0.9rem;">
            <div style="font-weight:600;" id="userName">Cargando...</div>
            <div style="font-size:0.8rem; color:var(--text-sec);">Usuario</div>
          </div>
        </div>
      </div>
    </aside>

    <main class="main-content">
      <div class="page-header">
        <h1>Mi Diario Personal</h1>
        <p class="page-subtitle">Un espacio seguro para tus pensamientos.</p>
      </div>

      <div class="diary-grid">
        <div class="cal-card">
          <div class="cal-header">
            <span id="calMonth">Marzo 2026</span>
            <div>
                <i class="fas fa-chevron-left" style="cursor:pointer; margin-right:10px;" onclick="moveMonth(-1)"></i>
                <i class="fas fa-chevron-right" style="cursor:pointer;" onclick="moveMonth(1)"></i>
            </div>
          </div>
          <div class="cal-grid" id="calGrid"></div>
          
          <div style="margin-top:20px; background:#FEF3C7; padding:15px; border-radius:12px;">
            <h4 style="color:#92400E; margin-bottom:5px; font-size:0.9rem;"><i class="fas fa-lightbulb"></i> Inspiraci칩n de hoy:</h4>
            <p style="color:#92400E; font-size:0.85rem; line-height:1.4;">"쯈u칠 peque침o logro conseguiste hoy, aunque nadie m치s lo haya notado?"</p>
          </div>
        </div>

        <div class="editor-card">
          <div class="editor-toolbar">
            <div>
                <div class="date-title" id="editorDate">Hoy</div>
                <div class="save-indicator" id="saveStatus"><i class="fas fa-check-circle"></i> Guardado</div>
            </div>
            <div class="emotions-bar">
                <button class="emo-btn" onclick="setMood('feliz')">游때 Feliz</button>
                <button class="emo-btn" onclick="setMood('calma')">游땗 Calma</button>
                <button class="emo-btn" onclick="setMood('triste')">游땩 Triste</button>
                <button class="emo-btn" onclick="setMood('ansiedad')">游땷 Ansioso</button>
            </div>
          </div>
          <textarea id="journalEntry" placeholder="Escribe aqu칤 libremente..."></textarea>
        </div>
      </div>
    </main>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../js/supabase-config.js"></script>
  <script>
    // L칩gica b치sica restaurada
    let currentDate = new Date();
    let selectedDate = new Date();
    let saveTimeout;

    async function init() {
        if (!window.sb) return setTimeout(init, 100);
        const { data: { user } } = await window.sb.auth.getUser();
        if (!user) window.location.href = '../login.html';
        
        // Cargar usuario en sidebar
        const { data: profile } = await window.sb.from('users_profile').select('*').eq('id', user.id).single();
        if (profile) {
            document.getElementById('userName').textContent = profile.nombre;
            document.getElementById('avatarInitials').textContent = profile.nombre.charAt(0);
        }

        renderCalendar();
        loadEntry(user.id);
        
        // Auto-save logic
        document.getElementById('journalEntry').addEventListener('input', () => {
            document.getElementById('saveStatus').innerHTML = '<i class="fas fa-pen"></i> Escribiendo...';
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => saveEntry(user.id), 1500);
        });
    }

    function renderCalendar() {
        const grid = document.getElementById('calGrid');
        grid.innerHTML = '';
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        document.getElementById('calMonth').textContent = new Date(year, month).toLocaleDateString('es-PE', { month: 'long', year: 'numeric' });
        const days = new Date(year, month + 1, 0).getDate();

        for (let i = 1; i <= days; i++) {
            const d = document.createElement('div');
            d.className = 'day';
            if (i === selectedDate.getDate() && month === selectedDate.getMonth()) d.classList.add('active');
            d.textContent = i;
            d.onclick = () => { selectedDate = new Date(year, month, i); renderCalendar(); document.getElementById('editorDate').textContent = selectedDate.toLocaleDateString('es-PE', {weekday:'long', day:'numeric'}); };
            grid.appendChild(d);
        }
    }

    async function saveEntry(uid) {
        // Simulaci칩n de guardado para la demo
        document.getElementById('saveStatus').innerHTML = '<i class="fas fa-check-circle"></i> Guardado';
    }

    async function logout() { await window.sb.auth.signOut(); window.location.href = '../login.html'; }
    
    init();
  </script>
</body>
</html>
